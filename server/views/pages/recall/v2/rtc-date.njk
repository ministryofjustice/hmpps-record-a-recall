{% extends "../../../partials/prisonerBannerLayout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}

{% set title = "Was this person in prison when the recall was made?" %}
{% set pageTitle = applicationName + " - " + title %}

{% block beforeContent %}
    {{ super() }}
    <div class="govuk-width-container">
        <div class="govuk-grid-row govuk-!-margin-bottom-0">
            <div class="govuk-grid-column-two-thirds">
                <nav>
                    {{ govukBackLink({
                        text: "Back",
                        href: backLink
                    }) }}
                </nav>
                {% include "../../../partials/errorSummary.njk" %}
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="govuk-width-container">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                <span class="govuk-caption-l">Record a recall</span>
                
                <form method="post" action="">
                    <input type="hidden" name="_csrf" value="{{ csrfToken }}">

                    {% set inPrisonError = validationErrors | findError('inPrisonAtRecall') %}
                    {% set rtcDateError = validationErrors | findError('returnToCustodyDate') %}
                    {% set inPrisonValue = formResponses.inPrisonAtRecall %}
                    
                    {# Extract date parts from formResponses #}
                    {% set rtcDateDay = formResponses['returnToCustodyDate-day'] if formResponses else "" %}
                    {% set rtcDateMonth = formResponses['returnToCustodyDate-month'] if formResponses else "" %}
                    {% set rtcDateYear = formResponses['returnToCustodyDate-year'] if formResponses else "" %}

                    {% set rtcDateHtml %}
                        {{ govukDateInput({
                            id: "returnToCustodyDate",
                            namePrefix: "returnToCustodyDate",
                            fieldset: {
                                legend: {
                                    text: "Date they were arrested",
                                    classes: "govuk-fieldset__legend--s"
                                }
                            },
                            hint: {
                                text: "For example, 18 10 2007"
                            },
                            errorMessage: rtcDateError,
                            items: [
                                {
                                    name: "day",
                                    classes: "govuk-input--width-2",
                                    value: rtcDateDay,
                                    attributes: {
                                        inputmode: "numeric"
                                    }
                                },
                                {
                                    name: "month",
                                    classes: "govuk-input--width-2",
                                    value: rtcDateMonth,
                                    attributes: {
                                        inputmode: "numeric"
                                    }
                                },
                                {
                                    name: "year",
                                    classes: "govuk-input--width-4",
                                    value: rtcDateYear,
                                    attributes: {
                                        inputmode: "numeric"
                                    }
                                }
                            ]
                        }) }}
                    {% endset %}

                    {{ govukRadios({
                        idPrefix: "inPrisonAtRecall",
                        name: "inPrisonAtRecall",
                        fieldset: {
                            legend: {
                                text: title,
                                isPageHeading: true,
                                classes: "govuk-fieldset__legend--l"
                            }
                        },
                        errorMessage: inPrisonError,
                        items: [
                            {
                                value: "true",
                                text: "Yes",
                                checked: inPrisonValue === true or inPrisonValue === "true"
                            },
                            {
                                value: "false",
                                text: "No",
                                checked: inPrisonValue === false or inPrisonValue === "false",
                                conditional: {
                                    html: rtcDateHtml
                                }
                            }
                        ]
                    }) }}

                    <div class="govuk-button-group">
                        {{ govukButton({
                            text: "Continue",
                            preventDoubleClick: true,
                            attributes: { id: "submit" }
                        }) }}
                        {{ govukButton({
                            text: "Cancel",
                            classes: "govuk-button--secondary",
                            href: cancelUrl
                        }) }}
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}