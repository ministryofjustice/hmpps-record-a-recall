{% from "govuk/components/date-input/macro.njk" import govukDateInput %}

{% macro validatedDateInput(opts) %}
  {% set id = opts.id %}
  {% set name = opts.name %}
  {% set hintText = opts.hintText %}
  {% set legendText = opts.legendText %}

  {% set day = opts.day %}
  {% set month = opts.month %}
  {% set year = opts.year %}

  {% if opts.validationErrors %}
    {% set dayError = opts.validationErrors['day'] if opts.validationErrors['day'] else '' %}
    {% set monthError = opts.validationErrors['month'] if opts.validationErrors['month'] else '' %}
    {% set yearError = opts.validationErrors['year']  if opts.validationErrors['year'] else '' %}
  {% endif %}

  {% macro joinErrors(errors) %}
    {% if errors %}{% for error in errors %}{% if error and error.length > 0 %}{{ error }}{% endif %}{% endfor %}{% endif %}
  {% endmacro %}

  {% if legendText %}
    {% set hintWithLegendHtml %}
      <span>
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
          <h2 class="govuk-fieldset__heading">{{ legendText }}</h2>
        </legend>
          <div id="dob-hint" class="govuk-hint">
            {{ hintText }}
          </div>
      </span>
    {% endset %}
  {% endif %}

  {% if hintWithLegendHtml %}
    {% set hint = { html: hintWithLegendHtml } %}
  {% else %}
    {% set hint = { text: hintText } %}
  {% endif %}

  {{ govukDateInput({
    id: id,
    name: name or id,
    hint: hint,
    errorMessage: {
      html: '<span id="day-error" class="govuk-error-message">' + joinErrors(dayError) + '</span>
                            <span id="month-error" class="govuk-error-message">' + joinErrors(monthError) + '</span>
                            <span id="year-error" class="govuk-error-message">' + joinErrors(yearError) + '</span>'
    } if dayError or monthError or yearError,
    items: [
      {
        id: 'day',
        label: 'Day',
        name: "day",
        classes: 'govuk-input--width-2' + (' govuk-input--error' if dayError),
        value: day
      },
      {
        id: 'month',
        label: 'Month',
        name: "month",
        classes: 'govuk-input--width-2' + (' govuk-input--error' if monthError),
        value: month
      },
      {
        id: 'year',
        label: 'Year',
        name: "year",
        classes: 'govuk-input--width-4' + (' govuk-input--error' if yearError),
        value: year
      }
    ]
  }) }}
{% endmacro %}
